#

export USER_BASE=$PSS_PATH
export USER_HOME="$PSS_PATH"
export USER_MAKE=presteraTopMake

# if MANAGEMENT_BUS_PARAM is not set by -b options
# By default we set MANAGEMENT_BUS_PARAM to PCI, except of Dx on ARM5181
if [ -z "$MANAGEMENT_BUS_PARAM" ]; then
    if [ "$CPU_BOARD" = "ARM5181" ] && [ "$CHX_FAMILY" = "EXISTS" ]
    then 
        MANAGEMENT_BUS_PARAM=PCI_SMI
     else
        MANAGEMENT_BUS_PARAM=$DEFAULT_MANAGEMENT_BUS
    fi
fi

PROJECT_DEFS="$PROJECT_DEFS IMPL_DRIVER IMPL_BRIDGE IMPL_PORT IMPL_SYSCONFIG"
PROJECT_DEFS="$PROJECT_DEFS IMPL_EVENTS IMPL_COREHWINIT"
PROJECT_DEFS="$PROJECT_DEFS IMPL_COS IMPL_NETWORKIF IMPL_TRUNK"
PROJECT_DEFS="$PROJECT_DEFS IMPL_LOGICALIF"
PROJECT_DEFS="$PROJECT_DEFS IMPL_MIRROR"
PROJECT_DEFS="$PROJECT_DEFS ENV_MAINCMD"

# PP specific features
case $MANAGEMENT_BUS_PARAM in
    PCI )
        PROJECT_DEFS="$PROJECT_DEFS GT_PCI"
        export GT_PCI="EXISTS"
        export MANAGEMENT_BUS=GT_MNG_PCI
        ;;
    SMI )
        PROJECT_DEFS="$PROJECT_DEFS GT_SMI"
        export GT_SMI="EXISTS"
        export MANAGEMENT_BUS=GT_MNG_SMI
        ;;
    PCI_SMI )
        PROJECT_DEFS="$PROJECT_DEFS GT_PCI GT_SMI"
        export GT_PCI="EXISTS"
        export GT_SMI="EXISTS"
        export MANAGEMENT_BUS=GT_MNG_PCI_SMI
        ;;
    PCI_I2C )
        PROJECT_DEFS="$PROJECT_DEFS GT_PCI GT_I2C"
        export GT_PCI="EXISTS"
        export GT_I2C="EXISTS"
        export MANAGEMENT_BUS=GT_MNG_PCI_I2C
        ;;
    PCI_SMI_I2C | ALL)
        PROJECT_DEFS="$PROJECT_DEFS GT_PCI GT_SMI GT_I2C"
        export GT_PCI="EXISTS"
        export GT_SMI="EXISTS"
        export GT_I2C="EXISTS"
        export MANAGEMENT_BUS=GT_MNG_PCI_SMI_I2C
        ;;
    * )
        error_message "Unknown MANAGEMENT BUS $MANAGEMENT_BUS_PARAM"
        exit 1
        ;;
esac

case $PRESTERA_FAMILY in
    DX_FAMILY)
        PROJECT_DEFS="$PROJECT_DEFS SALSA_FAMILY"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_NST"
        PROJECT_DEFS="$PROJECT_DEFS DX_FAMILY"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_PCL IMPL_ACTION IMPL_TRAFFICCOND"
        if [ "$IMPL_PCL_OPER" = "ON" ]; then
            PROJECT_DEFS="$PROJECT_DEFS IMPL_PCL_OPER"
        fi
        PROJECT_DEFS="$PROJECT_DEFS IMPL_SMI_CHANNEL_TO_PP"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_ARP"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_TUNNEL"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_IPV4TUNNEL"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_CUTTHROUGH"
        if [ "$EXCLUDE_IP" != "ON" ]; then
            PROJECT_DEFS="$PROJECT_DEFS IMPL_IP"
        fi
        ;;
    SX_FAMILY)
        PROJECT_DEFS="$PROJECT_DEFS IMPL_DIAG IMPL_SFLOW IMPL_HARDWARE"
        PROJECT_DEFS="$PROJECT_DEFS SOHO_FAMILY"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_SMI_CHANNEL_TO_PP"
        ;;
    EX_FAMILY | MX_FAMILY)
        PROJECT_DEFS="$PROJECT_DEFS EXMX_FAMILY"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_CLASSIFIER"
        if [ "$EXCLUDE_IP" != "ON" ]; then
            PROJECT_DEFS="$PROJECT_DEFS IMPL_IP"
        fi
        PROJECT_DEFS="$PROJECT_DEFS IMPL_ARP IMPL_TRAFFICCOND"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_PCL IMPL_ACTION"
        if [ "$IMPL_PCL_OPER" = "ON" ]; then
            PROJECT_DEFS="$PROJECT_DEFS IMPL_PCL_OPER"
        fi
        if [ "$XBAR_VENDOR" != "DUNE" -a "$EXCLUDE_XBAR" != "ON" ]; then
            PROJECT_DEFS="$PROJECT_DEFS IMPL_FADIAG IMPL_FA IMPL_XBARDRIVER"
        fi
        PROJECT_DEFS="$PROJECT_DEFS IMPL_PCI_CHANNEL_TO_PP"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_POLICY"
        if [ "$PRESTERA_FAMILY" = "MX_FAMILY" ]; then
            PROJECT_DEFS="$PROJECT_DEFS MX_FAMILY"
            PROJECT_DEFS="$PROJECT_DEFS IMPL_IPV4FILTER IMPL_HA IMPL_CM"
            PROJECT_DEFS="$PROJECT_DEFS IMPL_MPLS IMPL_MPLSTUNNEL IMPL_IPV4TUNNEL"
            # IMPL_NAT
        fi
        if [ "$PRESTERA_FAMILY" = "EX_FAMILY" ]; then
            PROJECT_DEFS="$PROJECT_DEFS EX_FAMILY"
            PROJECT_DEFS="$PROJECT_DEFS IMPL_IPV4TUNNEL IMPL_IPV4FILTER IMPL_CM"
        fi
        ;;
    EXMXPM_FAMILY)
        PROJECT_DEFS="$PROJECT_DEFS EXMXPM_FAMILY"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_PCL IMPL_ACTION IMPL_TRAFFICCOND"
        if [ "$IMPL_PCL_OPER" = "ON" ]; then
            PROJECT_DEFS="$PROJECT_DEFS IMPL_PCL_OPER"
        fi
        if [ "$XBAR_VENDOR" != "DUNE" -a "$EXCLUDE_XBAR" != "ON" ]; then
            PROJECT_DEFS="$PROJECT_DEFS IMPL_FADIAG IMPL_FA IMPL_XBARDRIVER"
        fi
        PROJECT_DEFS="$PROJECT_DEFS IMPL_SMI_CHANNEL_TO_PP"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_ARP"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_TUNNEL"
        PROJECT_DEFS="$PROJECT_DEFS IMPL_IPV4TUNNEL"
        if [ "$EXCLUDE_IP" != "ON" ]; then
            PROJECT_DEFS="$PROJECT_DEFS IMPL_IP"
        fi
        PROJECT_DEFS="$PROJECT_DEFS IMPL_NST"
        ;;
esac
case $SECOND_FAMILY in
	DX_FAMILY)
        PROJECT_DEFS="$PROJECT_DEFS DX_FAMILY IMPL_CM IMPL_VB"
		;;
	SX_FAMILY)
        PROJECT_DEFS="$PROJECT_DEFS SOHO_FAMILY IMPL_CM"
		;;
esac

if [ "$PRESTERA_FAMILY" = "DX_FAMILY" -a "$SECOND_FAMILY" = "SX_FAMILY" ]; then
    PROJECT_DEFS="$PROJECT_DEFS DXSX_FAMILY"
fi

# common features
if [ "$EXCLUDE_GALTIS" != "ON" ]; then
    PROJECT_DEFS="$PROJECT_DEFS IMPL_GALTIS"
fi

if [ "$AUTO_INIT_SYS" == "ENABLE" ]; then
    PROJECT_DEFS="$PROJECT_DEFS GT_AUTO_SYS_INIT"
fi

if [ "$PSS_MODE" == "PSS_DPSS" ]; then
    PROJECT_DEFS="$PROJECT_DEFS PSS_DPSS"
fi

if [ "$XBAR_VENDOR" == "DUNE" ]; then
    PROJECT_DEFS="$PROJECT_DEFS IMPL_DUNE"
    # Image for FE200
    PROJECT_DEFS="$PROJECT_DEFS DUNE_FE_IMAGE"
fi
#support hybrid of core FA and coreCpssDx
if [ "$PSS_CORE_FA" = "EXISTS" ]; then
    PROJECT_DEFS="$PROJECT_DEFS PSS_CORE_FA"
fi
#support hybrid of core BAR and coreCpssDx
if [ "$PSS_CORE_XBAR" = "EXISTS" ]; then
    PROJECT_DEFS="$PROJECT_DEFS PSS_CORE_XBAR"
fi


export BIN_BS=128
export BIN_SKIP=1
export AUTO_INIT_SYS=ENABLE

DRAGONITE_TYPE=NONE
. $tool_build/product/simulation.inc
